<%
collapsed ||= false
is_edit = ["edit", "update"].include? params[:action]

if @occasion
  occasion = @occasion
else
  occasion = Occasion.new(session[:last_occasion_added]) do |o|
    o.event_id = event.id

    unless session[:last_occasion_added]
      o.map_address = event.map_address 
      o.single_group = event.single_group_per_occasion
    end
  end
end
-%>

<fieldset class="occasion-form-container collapsible <%= "collapsed" if !@occasion && !collapsed %>">

  <legend><%= is_edit ? "Redigera" : "Lägg till" %> föreställning</legend>

  <%= form_for(occasion, :builder => KPFormBuilder, :html => { :class => "occasion-form" }) do |f| -%>

    <%= f.validation_error_indicator -%>

    <% f.fields do %>

      <%= f.text_field :date, :class => "date-field auto" %>
      <%= f.time_select :start_time, :minute_step => 5 %>
      <%= f.time_select :stop_time, :minute_step => 5 %>
      <%= f.text_field :seats %>
      <%= f.text_field :wheelchair_seats %>
      <%= f.check_box :single_group %>
      <%= f.text_area :address, :rows => 5 %>
      <%= f.text_area :description, :rows => 5 %>
      <%= f.check_box :telecoil %>
      <%= f.text_field :map_address %>

      <% f.buttons do %>
        <%= f.hidden_field :event_id %>
        <%= f.submit(is_edit ? "Uppdatera" : "Lägg till") %>
      <% end %>

    <% end %>

  <% end -%>

</fieldset>
