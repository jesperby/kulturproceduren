<%= render :partial => "questionnaires/menu" %>

<div class="model-cnt">
  <h2>Utvärderingsformulär för <%= link_to h(@questionnaire.event.name), @questionnaire.event %></h2>

  <ul class="admin-tools">
    <li><%= link_to "Redigera", edit_questionnaire_path(@questionnaire) %></li>
    <li><%= link_to "Radera", @questionnaire, :confirm => "Är du säker?", :method => :delete %></li>
  </ul>

  <p class="description">
    <%= h(@questionnaire.description) %>
  </p>

  <div class="context-form">
    <fieldset class="<%= "with-legend" unless @template_questions.empty? %>">
      <% unless @template_questions.empty? %>
        <legend><span>Välj en mallfråga</span></legend>

        <form action="<%= add_template_question_questionnaire_path(@questionnaire) %>"
              method="post"
              class="add-template-question-form"
              name="add_template_question_form">

          <div>
            <select name="question_id">
              <%= options_from_collection_for_select @template_questions, :id, :question %>
            </select>
            <input type="hidden" name="authenticity_token" value="<%= form_authenticity_token %>"/>
            <input type="submit" value="Lägg till mallfråga" name="do_submit"/>
          </div>
        </form>
      </fieldset>

      <fieldset class="with-legend">
        <legend><span>eller lägg till ny fråga</span></legend>
      <% end -%>

      <%= render :partial => "questions/form", :locals => { :question => @question, :questionnaire => @questionnaire } %>
    </fieldset>
  </div>


  <% unless @questionnaire.questions.empty? -%>

    <table>
      <thead>
        <tr>
          <th>Fråga</th>
          <th>Mallfråga</th>
          <th>Obligatorisk</th>
          <th colspan="2"></th>
        </tr>
      </thead>

      <tbody>

        <% @questionnaire.questions.each do |question| -%>
          <tr class="<%= cycle("", "even") %>">
            <td><%= h question.question %></td>
            <td><%= "Ja" if question.template %></td>
            <td><%= "Ja" if question.mandatory -%></td>
            <td><%= link_to "Redigera", edit_questionnaire_question_path(@questionnaire, question) unless question.template %></td>
            <% if question.template -%>
              <td>
                <%= link_to "Ta bort från enkät", remove_template_question_questionnaire_path(@questionnaire, :question_id => question.id), :method => :delete %>
              </td>
            <% else -%>
              <td>
                <%= link_to "Ta bort från enkät", questionnaire_question_path(@questionnaire, question), :confirm => "Är du säker?", :method => :delete %>
              </td>
            <% end -%>
          </tr>
        <% end -%>

      </tbody>
    </table>

  <% end -%>

</div>
