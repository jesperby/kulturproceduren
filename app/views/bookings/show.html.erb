<%# coding: utf-8 %>
<%= render :partial => "menu" %>

<h2 class="form-title">
  Bokningsbekräftelse för
  <%= @booking.group.school.name %>, <%= @booking.group.name %> till
  <%= link_to @booking.occasion.event.name, @booking.occasion.event -%>,
  föreställningen <%= @booking.occasion.date -%>
</h2>

<div class="admin-tools">
  <ul>
    <% if current_user.can_book? && !@booking.unbooked && !@booking.occasion.cancelled && @booking.occasion.date >= Date.today %>
      <li><%= link_to "Ändra bokning", edit_booking_path(@booking) %></li>
      <li>
        <%= link_to "Avboka", unbook_booking_path(@booking) %>
      </li>
    <% end %>
    <li><%= link_to_function "Skriv ut", "window.print()" %></li>
  </ul>
</div>

<table class="booking-confirmation-list">
  <tbody>
    <tr class="occasion-header">
      <th colspan="2">Arrangemang</th>
    </tr>
    <tr class="event">
      <th>Namn:</th>
      <td><%= link_to @booking.occasion.event.name, @booking.occasion.event %></td>
    </tr>
    <tr class="occasion-date">
      <th>Datum:</th>
      <td><%= @booking.occasion.date %></td>
    </tr>
    <tr class="occasion-time">
      <th>Tid:</th>
      <td><%= l @booking.occasion.start_time, :format => :only_time %> - <%= l @booking.occasion.stop_time, :format => :only_time %></td>
    </tr>
    <tr class="occasion-address">
      <th>Adress:</th>
      <td><%= linebreakize(@booking.occasion.address) %></td>
    </tr>
    <tr class="occasion-address">
      <th>Beskrivning:</th>
      <td><%= paragraphize(@booking.occasion.description) %></td>
    </tr>

    <tr class="booking-header">
      <th colspan="2">Bokning</th>
    </tr>
    <tr class="num-normal">
      <th>Antal platser för barn:</th>
      <td><%= @booking.student_count %></td>
    </tr>
    <tr class="num-adult">
      <th>Antal platser för vuxna:</th>
      <td><%= @booking.adult_count %></td>
    </tr>
    <% if @booking.wheelchair_count > 0 %>
      <tr class="num-wheelchair">
        <th>Antal platser för rullstolsbundna:</th>
        <td><%= @booking.wheelchair_count %></td>
      </tr>
    <% end %>
    <tr class="booking-time">
      <th>Bokad:</th>
      <td><%= l @booking.booked_at, :format => :long %></td>
    </tr>
    <% if @booking.unbooked %>
      <tr class="unbooking-time">
        <th>Avbokad:</th>
        <td><%= l @booking.unbooked_at, :format => :long %> av <%= link_to @booking.unbooked_by.name, @booking.unbooked_by %></td>
      </tr>
    <% end %>

    <tr class="companion-header">
      <th colspan="2">Medföljande vuxen</th>
    </tr>
    <tr class="companion-name">
      <th>Namn:</th>
      <td><%= @booking.companion_name %></td>
    </tr>
    <tr class="companion-email">
      <th>Epostadress:</th>
      <td><%= @booking.companion_email %></td>
    </tr>
    <tr class="companion-cellphone">
      <th>Mobilnummer:</th>
      <td><%= @booking.companion_phone %></td>
    </tr>

    <% if @booking.bus_booking? %>
      <tr class="bus-booking-header">
        <th colspan="2">Kulturbussbokning</th>
      </tr>
      <tr class="bus-stop">
        <th>Från hållplats:</th>
        <td><%= @booking.bus_stop %></td>
      </tr>
      <tr class="bus-stop">
        <th>Bokningstyp:</th>
        <td><%= @booking.bus_one_way ? "Enkel resa" : "Tur och retur" %></td>
      </tr>
    <% end %>

    <% unless @booking.requirement.blank? %>
      <tr class="requirement-header">
        <th colspan="2">Speciella krav / Extra information ang. bokning</th>
      </tr>
      <tr class="companion-name">
        <th>Extra behov:</th>
        <td><%= paragraphize(@booking.requirement) %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<% if @booking.unbooked %>
  <% if @booking.answer_form %>
    <h2 class="form-title">
      Svar på avbokningsenkäten
    </h2>

    <table class="unbooking-questionnaire-results-list">
      <% @booking.answer_form.answers.each do |answer| -%>
        <% question = answer.question -%>
        <tr>
          <th><%= question.question %>:</th>
          <td>
            <%=
            case question.qtype
            when "QuestionMark", "QuestionText" then answer.answer_text
            when "QuestionBool" then answer.answer_text == "y" ? "Ja" : "Nej"
            when "QuestionMchoice"
              choices = YAML.load(answer.answer_text).collect { |c| "<li>#{h(c)}</li>".html_safe }
              "<ul>#{choices}</ul>".html_safe
            end
            -%>
          </td>
        </tr>
      <% end %>
    </ul>
  <% end %>
<% else %>
  <div class="cancellation-info">

    <p>Eventuell avbokning av platser görs via er bokningsbekräftelse på
    www.malmo.se/kulturproceduren fram tills dagen före evenemanget.</p>

    <p>Behöver ni avboka era platser samma dag som evenemanget ber vi er ringa
    0709-17 38 77.</p>

  </div>
<% end %>
